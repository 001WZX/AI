<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>鞋类商城（成功案例同款）</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: Arial, sans-serif;
		}

		body {
			background: #f5f5f5;
			padding: 15px;
		}

		/* 头部和导航 */
		.top-bar {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}
		.admin-btn {
			padding: 8px 10px;
			background: #007bff;
			color: white;
			border: none;
			border-radius: 6px;
			font-size: 14px;
			cursor: pointer;
		}
		.nav {
			display: flex;
			background: #007bff;
			border-radius: 8px;
			overflow: hidden;
			margin-bottom: 15px;
		}
		.nav button {
			flex: 1;
			padding: 12px;
			border: none;
			background: transparent;
			color: white;
			font-size: 15px;
			cursor: pointer;
		}
		.nav button.active {
			background: #0056b3;
		}
		.banner {
			background: white;
			padding: 15px;
			border-radius: 10px;
			text-align: center;
			margin-bottom: 15px;
			box-shadow: 0 1px 4px rgba(0,0,0,0.1);
		}
		.search-box {
			margin-bottom: 15px;
		}
		.search-box input {
			width: 100%;
			padding: 10px;
			border-radius: 8px;
			border: 1px solid #ddd;
		}

		/* 商品列表 */
		.shoe-list {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 10px;
		}
		.shoe-item {
			background: white;
			border-radius: 10px;
			overflow: hidden;
			box-shadow: 0 1px 4px rgba(0,0,0,0.1);
			padding: 10px;
			text-align: center;
			position: relative;
		}
		.shoe-item img {
			width: 100%;
			height: 130px;
			object-fit: cover;
			border-radius: 6px;
			cursor: pointer;
		}
		.discount-tag {
			position: absolute;
			top: 5px;
			right: 5px;
			background: red;
			color: white;
			font-size: 12px;
			padding: 2px 5px;
			border-radius: 3px;
		}
		.shoe-name {
			font-size: 14px;
			font-weight: bold;
			margin: 6px 0 3px;
		}
		.price-box {
			display: flex;
			justify-content: center;
			gap: 6px;
			font-size: 14px;
		}
		.old-price {
			text-decoration: line-through;
			color: #999;
		}
		.new-price {
			color: red;
			font-weight: bold;
		}
		.shoe-code {
			font-size: 12px;
			color: #888;
		}

		/* 弹窗 */
		.modal {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.8);
			display: none;
			justify-content: center;
			align-items: center;
			z-index: 999;
		}
		.modal img {
			max-width: 90%;
			max-height: 80vh;
			border-radius: 10px;
		}
		.close {
			position: absolute;
			top: 20px;
			right: 20px;
			color: white;
			font-size: 30px;
			cursor: pointer;
		}

		/* 管理员面板 */
		.admin-panel {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: white;
			padding: 20px;
			display: none;
			z-index: 998;
			overflow: auto;
		}
		.admin-page {
			display: none;
		}
		.admin-page.active {
			display: block;
		}
		.input-item {
			margin-bottom: 10px;
		}
		.input-item input {
			width: 100%;
			padding: 10px;
			border: 1px solid #ddd;
			border-radius: 6px;
		}
		.btn {
			width: 100%;
			padding: 12px;
			border: none;
			border-radius: 6px;
			color: white;
			margin: 8px 0;
			font-size: 16px;
			cursor: pointer;
		}
		.btn-add { background: #28a745; }
		.btn-edit { background: #ffc107; color: #333; }
		.btn-del { background: #dc3545; }
		.btn-back { background: #6c757d; }
		.item-line {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 8px;
			background: #f1f1f1;
			margin-bottom: 6px;
			border-radius: 6px;
			font-size: 13px;
		}
		.item-line button {
			padding: 5px 8px;
			border: none;
			border-radius: 4px;
			color: white;
			background: red;
			cursor: pointer;
		}
		.empty-message {
			text-align: center;
			color: #999;
			padding: 20px;
		}
	</style>
</head>
<body>
	<div class="top-bar">
		<h2>鞋类商城</h2>
		<button class="admin-btn" onclick="showAdmin()">管理员</button>
	</div>

	<div class="nav">
		<button id="tab1" class="active" onclick="switchTab(1)">首页</button>
		<button id="tab2" onclick="switchTab(2)">特价区</button>
	</div>

	<div class="banner">
		<h2>精品鞋类 · 厂家直供</h2>
		<p>款式齐全 | 品质保障 | 特价优惠</p>
	</div>

	<div class="search-box">
		<input type="text" id="search" placeholder="搜索鞋名/货号" oninput="search()">
	</div>

	<div class="shoe-list" id="shoeList"></div>

	<div class="modal" id="imgModal">
		<span class="close" onclick="closeModal()">&times;</span>
		<img id="bigImg">
	</div>

	<div class="admin-panel" id="adminPanel">
		<div class="admin-page active" id="loginPage">
			<h3 style="text-align:center;margin-bottom:20px;">管理员登录</h3>
			<div class="input-item">
				<input type="password" id="pwd" placeholder="密码：123456">
			</div>
			<button class="btn btn-add" onclick="checkPwd()">登录</button>
			<button class="btn btn-back" onclick="closeAdmin()">取消</button>
		</div>

		<div class="admin-page" id="adminMenu">
			<h3 style="text-align:center;margin-bottom:20px;">管理员后台</h3>
			<button class="btn btn-add" onclick="showPage('addPage')">添加鞋子</button>
			<button class="btn btn-edit" onclick="showPage('editPage'); showEditList()">修改鞋子</button>
			<button class="btn btn-del" onclick="showPage('delPage'); showDelList()">删除鞋子</button>
			<button class="btn btn-back" onclick="closeAdmin()">关闭后台</button>
		</div>

		<div class="admin-page" id="addPage">
			<h3 style="text-align:center;margin-bottom:20px;">添加鞋子</h3>
			<div class="input-item">
				<input type="file" id="addImg" accept="image/*">
			</div>
			<div class="input-item">
				<input type="text" id="addName" placeholder="鞋子名称">
			</div>
			<div class="input-item">
				<input type="text" id="addOriginal" placeholder="发售价（元）">
			</div>
			<div class="input-item">
				<input type="text" id="addCode" placeholder="货号">
			</div>
			<button class="btn btn-add" onclick="addShoe()">确认添加</button>
			<button class="btn btn-back" onclick="showPage('adminMenu'); clearAddInput()">返回菜单</button>
		</div>

		<div class="admin-page" id="editPage">
			<h3 style="text-align:center;margin-bottom:20px;">修改鞋子</h3>
			<div id="editList"></div>
			<div id="editForm" style="display:none;margin-top:20px;">
				<div class="input-item">
					<input type="text" id="editName" placeholder="鞋子名称">
				</div>
				<div class="input-item">
					<input type="text" id="editOriginal" placeholder="发售价（元）">
				</div>
				<div class="input-item">
					<input type="text" id="editDiscount" placeholder="打几折（例：8.5）">
				</div>
				<div class="input-item">
					<input type="text" id="editCode" placeholder="货号">
				</div>
				<button class="btn btn-edit" onclick="saveEdit()">保存修改</button>
			</div>
			<button class="btn btn-back" onclick="showPage('adminMenu'); editIndex=-1; document.getElementById('editForm').style.display='none'">返回菜单</button>
		</div>

		<div class="admin-page" id="delPage">
			<h3 style="text-align:center;margin-bottom:20px;">删除鞋子</h3>
			<div id="delList"></div>
			<button class="btn btn-back" onclick="showPage('adminMenu')">返回菜单</button>
		</div>
	</div>

	<script>
		// ✅ 完全照搬成功案例：所有鞋子（默认+新增）存在一个数组，每个鞋都有唯一ID
		let shoes = JSON.parse(localStorage.getItem('shoes')) || [
			{id: 1001, img:"https://picsum.photos/300/200?random=1", name:"经典板鞋", original:299, discount:1, code:"X001"},
			{id: 1002, img:"https://picsum.photos/300/200?random=2", name:"运动跑鞋", original:399, discount:0.8, code:"X002"},
			{id: 1003, img:"https://picsum.photos/300/200?random=3", name:"小白鞋", original:259, discount:1, code:"X003"},
			{id: 1004, img:"https://picsum.photos/300/200?random=4", name:"高帮板鞋", original:329, discount:0.75, code:"X004"}
		];
		let currentTab = 1;
		let editIndex = -1;

		// ✅ 渲染主界面商品列表（和成功案例的 renderProducts 逻辑一致）
		function render() {
			let list = [...shoes];
			if (currentTab === 2) {
				list = list.filter(item => (item.discount || 1) < 1);
			}
			let html = "";
			list.forEach(item => {
				const original = Number(item.original) || 0;
				const discount = Number(item.discount) || 1;
				const isSale = discount < 1;
				const realPrice = (original * discount).toFixed(2);

				if (isSale) {
					html += `
					<div class="shoe-item">
						<div class="discount-tag">${discount}折</div>
						<img src="${item.img}" onclick="showModal('${item.img}')">
						<div class="shoe-name">${item.name}</div>
						<div class="price-box">
							<span class="old-price">${original}元</span>
							<span class="new-price">${realPrice}元</span>
						</div>
						<div class="shoe-code">${item.code}</div>
					</div>`;
				} else {
					html += `
					<div class="shoe-item">
						<img src="${item.img}" onclick="showModal('${item.img}')">
						<div class="shoe-name">${item.name}</div>
						<div class="price-box">
							<span class="new-price">${original}元</span>
						</div>
						<div class="shoe-code">${item.code}</div>
					</div>`;
				}
			});
			document.getElementById("shoeList").innerHTML = html;
		}

		// 搜索功能
		function search() {
			const key = document.getElementById("search").value.toLowerCase();
			let list = shoes.filter(s => 
				(s.name || "").toLowerCase().includes(key) || (s.code || "").toLowerCase().includes(key)
			);
			if (currentTab === 2) list = list.filter(s => (s.discount || 1) < 1);

			let html = "";
			list.forEach(item => {
				const original = Number(item.original) || 0;
				const discount = Number(item.discount) || 1;
				const isSale = discount < 1;
				const realPrice = (original * discount).toFixed(2);

				if (isSale) {
					html += `
					<div class="shoe-item">
						<div class="discount-tag">${discount}折</div>
						<img src="${item.img}" onclick="showModal('${item.img}')">
						<div class="shoe-name">${item.name}</div>
						<div class="price-box">
							<span class="old-price">${original}元</span>
							<span class="new-price">${realPrice}元</span>
						</div>
						<div class="shoe-code">${item.code}</div>
					</div>`;
				} else {
					html += `
					<div class="shoe-item">
						<img src="${item.img}" onclick="showModal('${item.img}')">
						<div class="shoe-name">${item.name}</div>
						<div class="price-box">
							<span class="new-price">${original}元</span>
						</div>
						<div class="shoe-code">${item.code}</div>
					</div>`;
				}
			});
			document.getElementById("shoeList").innerHTML = html;
		}

		// 标签切换/弹窗/管理员面板
		function switchTab(n) {
			currentTab = n;
			document.getElementById("tab1").classList.remove("active");
			document.getElementById("tab2").classList.remove("active");
			document.getElementById("tab"+n).classList.add("active");
			render();
		}
		function showModal(url) {
			document.getElementById("bigImg").src = url;
			document.getElementById("imgModal").style.display = "flex";
		}
		function closeModal() {
			document.getElementById("imgModal").style.display = "none";
		}
		function showAdmin() {
			document.getElementById("adminPanel").style.display = "block";
			showPage("loginPage");
		}
		function closeAdmin() {
			document.getElementById("adminPanel").style.display = "none";
		}
		function showPage(pageId) {
			document.querySelectorAll(".admin-page").forEach(p => p.classList.remove("active"));
			document.getElementById(pageId).classList.add("active");
		}
		function checkPwd() {
			if (document.getElementById("pwd").value === "123456") {
				showPage("adminMenu");
			} else {
				alert("密码错误！");
			}
		}

		// ✅ 添加鞋子：照搬成功案例ID逻辑（Date.now()）
		function addShoe() {
			const img = document.getElementById("addImg");
			const name = document.getElementById("addName").value;
			const original = Number(document.getElementById("addOriginal").value);
			const code = document.getElementById("addCode").value;

			if (!name || !original || !code) {
				alert("请填写完整！");
				return;
			}

			const newShoe = {
				id: Date.now(), // 成功案例原生ID逻辑
				img: img.files[0] ? URL.createObjectURL(img.files[0]) : "https://picsum.photos/300/200",
				name: name,
				original: original,
				discount: 1,
				code: code
			};

			shoes.unshift(newShoe);
			localStorage.setItem("shoes", JSON.stringify(shoes));
			render();
			alert("添加成功！");
			clearAddInput();
			showPage("adminMenu");
		}
		function clearAddInput() {
			document.getElementById("addImg").value = "";
			document.getElementById("addName").value = "";
			document.getElementById("addOriginal").value = "";
			document.getElementById("addCode").value = "";
		}

		// 修改功能
		function showEditList() {
			let html = "";
			shoes.forEach((item, i) => {
				html += `
				<div class="item-line">
					<span>${item.name} ${item.code}</span>
					<button onclick="startEdit(${i})" style="background:orange;">修改</button>
				</div>`;
			});
			document.getElementById("editList").innerHTML = html;
		}
		function startEdit(index) {
			const shoe = shoes[index];
			editIndex = index;
			document.getElementById("editName").value = shoe.name;
			document.getElementById("editOriginal").value = shoe.original;
			document.getElementById("editDiscount").value = shoe.discount;
			document.getElementById("editCode").value = shoe.code;
			document.getElementById("editForm").style.display = "block";
		}
		function saveEdit() {
			if (editIndex < 0) return;
			const name = document.getElementById("editName").value;
			const original = Number(document.getElementById("editOriginal").value);
			const discount = Number(document.getElementById("editDiscount").value);
			const code = document.getElementById("editCode").value;

			if (!name || !original || !discount || !code) {
				alert("请填写完整！");
				return;
			}

			shoes[editIndex] = {
				...shoes[editIndex],
				name, original, discount, code
			};
			localStorage.setItem("shoes", JSON.stringify(shoes));
			render();
			alert("修改成功！");
			editIndex = -1;
			document.getElementById("editForm").style.display = "none";
			showEditList();
		}

		// ✅ 渲染删除列表：所有鞋都显示，点击删除按钮传ID（和成功案例完全一致）
		function showDelList() {
			let html = "";
			shoes.forEach((item) => {
				html += `
				<div class="item-line">
					<span>${item.name} ${item.code}</span>
					<button onclick="deleteShoe(${item.id})">删除</button>
				</div>`;
			});
			if (shoes.length === 0) {
				html = '<div class="empty-message">暂无鞋子可删除！</div>';
			}
			document.getElementById("delList").innerHTML = html;
		}

		// ✅ 核心删除函数：纯成功案例逻辑，删完立刻刷新两个页面
		function deleteShoe(id) {
			if (confirm('确定要删除这款鞋子吗？')) {
				// 1. 从数组中过滤掉要删除的鞋（成功案例核心）
				shoes = shoes.filter(shoe => shoe.id !== id);
				// 2. 同步到本地存储
				localStorage.setItem("shoes", JSON.stringify(shoes));
				// 3. 刷新主界面，商品立刻消失
				render();
				// 4. 刷新删除列表，那一行立刻消失
				showDelList();
				// 5. 提示成功
				alert('✓ 鞋子已删除！');
			}
		}

		// 页面初始化渲染
		render();
	</script>
</body>
</html>
